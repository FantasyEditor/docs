# 单位属性

单位属性是影响单位行为的一系列数值。除了个别特殊的内置属性，大多数的单位属性实际是由两个数值合并而成。

> 实际值 = 基础值 * (1 + 百分比 / 100)

理解这点，才能明白修改单位的三个api，`set`，`get`，`add`内在区别。

``` lua
  -- 获取的是 实际值
  u:get '攻击'
  -- 基础值设置为10，百分比设置为0，实际值(计算结果)为10
  u:set('攻击', 10)
  -- 基础值增加10，百分比不变
  u:add('攻击', 10)
  -- 百分比增加10，基础值不变
  u:add('攻击%', 10)
  -- 会报错
  u:get '攻击%'
  -- 会报错
  u:set('攻击%', 10)
```

此外影响单位属性的还有最大值和最小值，所以实际公式应该为

> 实际值 = min(最大值，max(最小值， 基础值 * (1 + 百分比 / 100)))

不过最大值和最小值并不一定存在，当它不存在时，就不会对单位属性有影响。

``` lua
  u:set('攻击', 100)
  print(u:get '攻击')
  u:set_attribute_max('攻击', 20)
  print(u:get '攻击')
  u:set_attribute_max('攻击')
  print(u:get '攻击')
```

显示的结果为

``` text
100
20
100
```

为了节约网络资源，默认的情况下大多数的属性都不会通知客户端。你可以根据自己的需要选择同步哪些属性，以及用什么[同步方式]。

属性的最大值、最小值和同步方式，都有一个全局的值和单位自己的值。单位的属性只受单位自己的值影响。单位的值在单位创建时，从全局值复制而来。所以修改全局值不会影响已经存在的单位，只会影响之后创建的单位。

幻想编辑器提供了21个内置属性和78个[自定义属性]。其中有16个属性是引擎内置的属性，它们确保了所有的基础设施的正常运作，无法禁用；此外还有5个内置属性是有底层lua以及客户端UI提供支持的属性，当你有能力修改这两部分内容时是可以被移除的。

### 内置属性

#### 攻击
+ 单位的攻击所能造成的伤害。

#### 护甲
+ 单位的受到伤害时可以减免一部分伤害。
+ 当护甲大于0时，每1点护甲可以使单位多承受1%的伤害，此时伤害算法为 `最终伤害 = 伤害 / (1 + 护甲 * 0.01)`
+ 当护甲小于0时，每1点护甲会使单位受到的伤害提升1%，此时伤害算法为 `最终伤害 = 伤害 * (1 + 护甲 * 0.01)`

#### 生命
+ 单位的生命无法小于0，也无法超过[生命上限]。
+ 特别注意，生命值与单位是否存活没有必然的关系。

#### 生命上限
+ 单位的[生命]无法超过生命上限。

#### 生命恢复
+ 单位每秒会增长的[生命]。
+ 当单位死亡时，该属性会暂时失效。

#### 魔法
+ 单位的魔法无法小于0，也无法超过[魔法上限]。
+ 发动技能可以消耗魔法。

#### 魔法上限
+ 单位的[魔法]无法超过魔法上限。

#### 魔法恢复
+ 单位每秒会增长的[魔法]。
+ 当单位死亡时，该属性会暂时失效。

#### 攻击速度
+ 单位每秒能发动攻击的次数。

#### 移动速度
+ 单位每秒能行走的距离。

#### 冷却缩减
+ 单位技能冷却时间减少的比例。
+ 该值为`40`表示技能的冷却时间减少`40%`。

#### 减耗
+ 单位技能魔法消耗减少的比例。
+ 该值为`40`表示技能的魔法消耗减少`40%`。

#### 攻击范围
+ 单位当前攻击的攻击范围。
+ 这个值由单位当前的[攻击技能]决定，修改这个属性会修改当前[攻击技能]的施法范围。

#### 搜敌范围
+ 这个值决定了AI在搜索附近敌人时，搜索范围可以超出[攻击范围]的距离。

#### 视野范围
+ 单位获得视野的范围。

### 自定义属性
+ 在[Constant]中可以定义自定义属性。
+ 服务器不关心自定义属性的含义，仅仅在同步方式允许的情况下将数值转发给客户端。
+ 部分自定义属性可以用在客户端UI（仅针对默认UI），以及服务器脚本库中，这里做一下简单介绍。

#### 等级
+ 用于[英雄升级]库。
+ 会显示在部分类型的血条旁边，以及UI头像附近。

#### 经验
+ 用于[英雄升级]库。
+ 会显示在UI头像附近。

#### 经验上限
+ 用于[英雄升级]库。
+ 会显示在UI头像附近。

#### 技能点
+ 用于[英雄升级]库。

#### 护盾
+ 用于[伤害结算]库。
+ 部分类型的血条中会显示为蓝色的进度条。

[生命]: /ac/unit/attribute?id=生命
[生命上限]: /ac/unit/attribute?id=生命上限
[魔法]: /ac/unit/attribute?id=魔法
[魔法上限]: /ac/unit/attribute?id=魔法上限
[攻击范围]: /ac/unit/attribute?id=攻击范围

[Constant]: 404
[英雄升级]: 404
[伤害结算]: 404
[同步方式]: 404
[自定义属性]: 404

### 相关API
